

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>The aerosol module &mdash; pyRT_DISORT  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The atmosphere module" href="atmosphere.html" />
    <link rel="prev" title="The rayleigh module" href="rayleigh.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyRT_DISORT
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Useful links</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../users-guide.html">User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="observation.html">The observation module</a></li>
<li class="toctree-l2"><a class="reference internal" href="eos.html">The eos module</a></li>
<li class="toctree-l2"><a class="reference internal" href="rayleigh.html">The rayleigh module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The aerosol module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conrath">Conrath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nearestneighborforwardscattering">NearestNeighborForwardScattering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opticaldepth">OpticalDepth</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nearestneighbortabularlegendrecoefficients">NearestNeighborTabularLegendreCoefficients</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="atmosphere.html">The atmosphere module</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller.html">The controller module</a></li>
<li class="toctree-l2"><a class="reference internal" href="radiation.html">Radiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="surface.html">Surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_the_model.html">Running the model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference.html">pyRT_DISORT API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about-disort.html">About DISORT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about-pyRT_DISORT.html">About pyRT_DISORT</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyRT_DISORT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../users-guide.html">User’s Guide</a> &raquo;</li>
        
      <li>The aerosol module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/rst/users-guide/aerosol.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-aerosol-module">
<h1>The aerosol module<a class="headerlink" href="#the-aerosol-module" title="Permalink to this headline">¶</a></h1>
<p>We just created 3 arrays for Rayleigh scattering; now, we need to make the same
arrays for dust.</p>
<div class="section" id="conrath">
<h2>Conrath<a class="headerlink" href="#conrath" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to use a Conrath profile. <a class="reference internal" href="../api-reference/aerosol.html#aerosol.Conrath" title="aerosol.Conrath"><code class="xref py py-class docutils literal notranslate"><span class="pre">Conrath</span></code></a>
provides the ability to construct a Conrath profile. For our retrieval, this
profile will be used to define the aerosol weighting within the <em>layers</em>. Let’s
assume the midpoint altitudes are a good representation of the layer altitudes
and construct them here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z_midpoint</span> <span class="o">=</span> <span class="p">((</span><span class="n">z_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">z_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then set the Conrath parameters, and access the profile via the class
property</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">Conrath</span>

<span class="n">q0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">conrath</span> <span class="o">=</span> <span class="n">Conrath</span><span class="p">(</span><span class="n">z_midpoint</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>

<span class="n">dust_profile</span> <span class="o">=</span> <span class="n">conrath</span><span class="o">.</span><span class="n">profile</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This module also comes with <a class="reference internal" href="../api-reference/aerosol.html#aerosol.Uniform" title="aerosol.Uniform"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uniform</span></code></a> to make constant
mixing ratio profiles. This may be more applicable to water-ice clouds so we
won’t use it here, but it’s worth mentioning its existence.</p>
</div>
</div>
<div class="section" id="nearestneighborforwardscattering">
<h2>NearestNeighborForwardScattering<a class="headerlink" href="#nearestneighborforwardscattering" title="Permalink to this headline">¶</a></h2>
<p>The last preparation step we need to do is define the aerosol’s forward
scattering properties.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I assume that an aerosol’s properties are a function of particle size and
wavelength. If you have properties that aren’t a function of both of those,
you can use functions like <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.broadcast_to.html">np.broadcast_to()</a>
to make 3D arrays.</p>
</div>
<p>I include some dust scattering properties in the tests directory, so let’s get
them, along with the grid over which they’re defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;~/pyRT_DISORT/tests/aux/dust_properties.fits&#39;</span>
<span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">cext</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">csca</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">wavs</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;wavelengths&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">psizes</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Now, we simply need to define a grid of particle sizes where to get these
properties (and the wavelengths too, but we already defined these). We should
also define the wavelength reference—the wavelength to scale all values to.
This value will come in handy when creating the optical depth profile.</p>
<p>Finally, the particle sizes and wavelengths at which the properties are defined
aren’t necessarily the ones we want to use, so we need to select how to how to
get values at undefined grid locations. For this example I’ll use nearest
neighbor.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I made a generic <code class="xref py py-class docutils literal notranslate"><span class="pre">aerosol.Interpolator</span></code> class to do various different
kinds of interpolation. This class is almost entirely a wrapper around that
class.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">particle_size_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">wave_ref</span> <span class="o">=</span> <span class="mf">9.3</span>

<span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">NearestNeighborForwardScattering</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">NearestNeighborForwardScattering</span><span class="p">(</span><span class="n">csca</span><span class="p">,</span> <span class="n">cext</span><span class="p">,</span> <span class="n">psizes</span><span class="p">,</span> <span class="n">wavs</span><span class="p">,</span> <span class="n">particle_size_grad</span><span class="p">,</span>
                                      <span class="n">pixel_wavelengths</span><span class="p">,</span> <span class="n">wave_ref</span><span class="p">)</span>
<span class="n">dust_ssa</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">single_scattering_albedo</span>
</pre></div>
</div>
<p>I won’t list all of the properties, but this object allows you to see the
the input coefficients on this new grid. It also defines the single scattering
albedo, and extinction profile of this new grid. We’ve actually already defined
the single scattering albedo already, so let’s now create the optical depth
array.</p>
</div>
<div class="section" id="opticaldepth">
<h2>OpticalDepth<a class="headerlink" href="#opticaldepth" title="Permalink to this headline">¶</a></h2>
<p>Now that we have the extinction profile from <code class="code docutils literal notranslate"><span class="pre">nnfs</span></code>, we can make the array
of optical depth with <a class="reference internal" href="../api-reference/aerosol.html#aerosol.OpticalDepth" title="aerosol.OpticalDepth"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpticalDepth</span></code></a>. I’ll plug in everything
and let it calculate. Essentially, all it needs to know to compute the optical
depth is the the vertical mixing ratio profile along with the column density in
each layer. It’ll allocate the optical such that the total optical depth sums
up to the column integrated optical depth (which I set to 1 here), and is then
scaled to the wavelength reference that defined extinction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">OpticalDepth</span>

<span class="n">od</span> <span class="o">=</span> <span class="n">OpticalDepth</span><span class="p">(</span><span class="n">dust_profile</span><span class="p">,</span> <span class="n">hydro</span><span class="o">.</span><span class="n">column_density</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">extinction</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dust_od</span> <span class="o">=</span> <span class="n">od</span><span class="o">.</span><span class="n">total</span>
</pre></div>
</div>
<p>With that, we have the optical depth computed.</p>
</div>
<div class="section" id="nearestneighbortabularlegendrecoefficients">
<h2>NearestNeighborTabularLegendreCoefficients<a class="headerlink" href="#nearestneighbortabularlegendrecoefficients" title="Permalink to this headline">¶</a></h2>
<p>Now, we just need to make the phase function. The general idea is that any
phase function will be defined on an input grid of particle sizes and
wavelengths. pyRT_DISORT comes with an abstract
<a class="reference internal" href="../api-reference/aerosol.html#aerosol.TabularLegendreCoefficients" title="aerosol.TabularLegendreCoefficients"><code class="xref py py-class docutils literal notranslate"><span class="pre">TabularLegendreCoefficients</span></code></a> that houses some methods to help
create a phase function. But something more practical might be
<a class="reference internal" href="../api-reference/aerosol.html#aerosol.NearestNeighborTabularLegendreCoefficients" title="aerosol.NearestNeighborTabularLegendreCoefficients"><code class="xref py py-class docutils literal notranslate"><span class="pre">NearestNeighborTabularLegendreCoefficients</span></code></a>. As before, we
just need to give this object the phase function, the particle size and
wavelength grid over which it’s defined, and the particle size and wavelength
grid over which we want the phase function. Let’s go ahead and do that here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Suppose you have an analytic phase function like Henyey-Greenstein. Even in
this case it depends on the asymmetry parameter, which is itself only
empirically determined at certain sizes and wavelengths. In this case, we
just need to convert the asymmetry parameter into Legendre coefficients,
then we have an array that’s functionally identical to empirical, tabular
Legendre coefficients.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyRT_DISORT.aerosol</span> <span class="kn">import</span> <span class="n">NearestNeighborTabularLegendreCoefficients</span>

<span class="n">dust_phsfn_file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;~/pyRT_DISORT/tests/aux/dust_phase_function.fits&#39;</span><span class="p">)</span>
<span class="n">coeff</span> <span class="o">=</span> <span class="n">dust_phsfn_file</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">pf_wavs</span> <span class="o">=</span> <span class="n">dust_phsfn_file</span><span class="p">[</span><span class="s1">&#39;wavelengths&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">pf_psizes</span> <span class="o">=</span> <span class="n">dust_phsfn_file</span><span class="p">[</span><span class="s1">&#39;particle_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="n">pf</span> <span class="o">=</span> <span class="n">NearestNeighborTabularLegendreCoefficients</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">pf_psizes</span><span class="p">,</span> <span class="n">pf_wavs</span><span class="p">,</span>
                                                <span class="n">pgrad</span><span class="p">,</span> <span class="n">pixel_wavelengths</span><span class="p">)</span>
<span class="n">dust_pf</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">phase_function</span>
</pre></div>
</div>
<p>And before you know it, we’ve created all the things we need for dust!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="atmosphere.html" class="btn btn-neutral float-right" title="The atmosphere module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="rayleigh.html" class="btn btn-neutral float-left" title="The rayleigh module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, kconnour.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>